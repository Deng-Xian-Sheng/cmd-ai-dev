# 视觉

创建一个py文件：look_imgs.py

这个py文件顶部有：
```
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
```

这个py文件实现了一个linux命令，该命令接受多个图片文件路径，支持相对和绝对路径，无需限制路径范围。

它会使用python-magic判断是不是图片，如果有任何一个不是图片，则会报错。报错应说明哪个文件不是图片，检测到是什么。
Dockerfile中应确保python-magic已经安装

它有一个参数来限制图片的大小：`--max-size`，单位是MB，接受整数，默认是3MB，如果输入的图片中有任何一个超过这个大小，会报错。报错应说明哪个文件超过了`--max-size`，`--max-size`默认是多大。并提醒对于较大的图片应先压缩或者缩放后再调用look_imgs命令，避免因为过大导致网络传输失败或者超过OpenAI API、模型供应商的限制。

它会读取图片并转换为base64然后存到AI工作目录下的look_imgs.json中。
需要在提示词中提醒模型这里面是base64，很大很长，不要直接cat它。
同时提醒模型也不要直接cat session.json，它里面有base64，也很大很长。
若要查看它们则需要使用其他方式。

这个命令不会返回任何内容，无返回则成功，有报错会报错，注意幂等，如果报错则base64 json不应有任何内容。

cmd-ai-dev.py会在<cmd></cmd>执行之后检查是否存在look_imgs.json文件，里面有没有值，如果有，则将它们添加到messages中并清空look_imgs.json。按照现有逻辑，命令执行之后会将结果发给模型，此时图片base64会带上。
在重置会话或者停止执行的时候，也需要**按需**清空它，这部分需要多加注意。

需要将cmd-ai-dev.py中当前的OpenAI API messages格式换成支持视觉的，也就是说content字段从字符串改成数组。
这个有一定的复杂性，需要多加注意。

一旦添加到messages,就会按现有的逻辑持久化、发送给模型等
但需要编辑相关逻辑，确保在逻辑不变的情况下将messages格式换成支持视觉的。

仅对OpenAISDKClient支持视觉，其他的供应商不用支持，这个支持不应影响其他供应商，其他供应商的模型收到的内容不应因这个支持而发生改变。