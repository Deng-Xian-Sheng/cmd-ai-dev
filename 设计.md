我想开发一个大道至简的命令行AI编程工具，请你帮助我完成这项任务。

是这样的，我最近看了一些帖子和视频，它们都提到了一个共同的观点：
大道至简，构建一个AI编程工具不需要很复杂，很复杂的设计不能提高模型的能力（或者只能在基准上体现，实际不明显），AI编程工具的效果取决于模型的能力，随着模型越来越智能，一个简单但足够灵活的AI编程工具能让模型发挥最大能力，从而超过那些设计冗余的复杂工具。
视频指出比起简洁的AI编程工具，复杂工具有时不仅不能提升模型能力，还会影响模型的发挥。

所以，我打算开发一个简单的AI编程工具，经过我查询资料和经验分析，我打算基于命令行实现，原因主要是开发成本低，不需要GUI，也不需要Web技术栈。

然后，我发现绝大多数基于命令行的AI编程工具例如claude code、open code、gemini cli等，都是模型输出在上面，用户输入在下面一个比较窄的输入框中，有些甚至不能换行。

mac book是接近正方形的屏幕，而屏幕有的是16:9，模型的输出会很多，但用户的输入也不见得少，有些用户可能会想输入一大段文字。

所以，使用起来就很“憋得慌”，我打算把模型输出放在左侧，用户输入放在右侧，左右分而不是上下分。

然后，我打算将一个灵活性特别高的东西提供给模型，那就是命令行，有了它，模型可以做几乎任何事，比如添加文件、修改文件、编写一个shell脚本或者python脚本来辅助模型做什么、安装apt、api包……灵活性很高。

与此同时用户的掌控度低了，所以我打算将这个工具跑在docker容器中，代码库通过目录映射的形式映射进去。

这样，一个虚拟环境，模型就可以尽情操作了，即使用户有洁癖也不必担心模型的操作影响真实系统。

这是我开发的这个AI编程工具的目录，它就叫cmd-ai-dev好了：
```
likewendy@likewendy-PC:~/Desktop/cmd-ai-dev$ pwd
/home/likewendy/Desktop/cmd-ai-dev
```

我创建了一个Dockerfile
```
likewendy@likewendy-PC:~/Desktop/cmd-ai-dev$ tree
.
├── 设计.md
├── cmd-ai-dev.py
└── Dockerfile

1 directory, 3 files
```

目前刚找好镜像：
```
FROM docker.cnb.cool/cnb/cool/default-dev-env/dockerfile-caches:ba8c7bf15bfb07dec83820d9a3878fa3134a09a3
```

在找镜像的时候我想选择python镜像来着，但是我不知道里面是不是ubuntu，因为在使用构建好的镜像的时候，还需要通过vscode这样的ide进入容器内开发，所以不知道缺少什么系统包。

我又看了ubuntu的镜像，发现它是最小镜像，还是需要自己安装很多包。

于是我选择了腾讯cnb平台提供的一个镜像，这个包类似于github space，但是更国内本地化。

这是这个镜像构建时的Dockerfile：
```
FROM cnbcool/default-build-env:latest

ENV UV_INSTALL_DIR=/usr/local/bin

# install vscode and extension
RUN curl -fsSL https://code-server.dev/install.sh | sh &&\
    code-server --install-extension cnbcool.cnb-welcome &&\
    code-server --install-extension redhat.vscode-yaml &&\
    code-server --install-extension waderyan.gitblame &&\
    code-server --install-extension mhutchie.git-graph &&\
    code-server --install-extension donjayamanne.githistory &&\
    code-server --install-extension cloudstudio.live-server &&\
    code-server --install-extension tencent-cloud.coding-copilot &&\
    code-server --install-extension bierner.markdown-mermaid
    

# 安装 ssh 服务，用于支持 VSCode 客户端通过 Remote-SSH 访问开发环境，开发环境需保留 apt-get 缓存
RUN apt-get update && apt-get install -y wget unzip lsof nload htop net-tools dnsutils openssh-server zsh

# 安装 uv
RUN sh -c "$(curl -LsSf https://astral.sh/uv/install.sh)"

COPY scripts ./scripts

RUN sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)" && \
    git clone https://github.com/zsh-users/zsh-autosuggestions ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-autosuggestions && \
    git clone https://github.com/zsh-users/zsh-syntax-highlighting.git ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-syntax-highlighting && \
    chmod +x ./scripts/*.sh && \
    ./scripts/add-zsh-plugins.sh zsh-autosuggestions zsh-syntax-highlighting && \
    ./scripts/set-zsh-env.sh && \
    echo 'setopt NO_AUTO_REMOVE_SLASH' >> /root/.zshrc && \
    mkdir -p ~/.oh-my-zsh/completions && \
    chsh -s $(which zsh)

# 在最开始 source /etc/profile 
RUN sed -i '1isetopt NULL_GLOB 2>/dev/null\n\
source /etc/profile\n\
unsetopt NULL_GLOB 2>/dev/null\n\
if command -v docker > /dev/null; then\n\
    docker completion zsh > ~/.oh-my-zsh/completions/_docker\n\
fi' $HOME/.zshrc


COPY settings.json /root/.vscode-server/data/Machine/settings.json
COPY settings.json /root/.local/share/code-server/Machine/settings.json
COPY cnb-init-from /bin/cnb-init-from
COPY cnb-init-from-without-lfs /bin/cnb-init-from-without-lfs
COPY gitconfig /root/.gitconfig

# 指定字符集支持命令行输入中文（根据需要选择字符集）
ENV LANG=C.UTF-8
ENV LANGUAGE=C.UTF-8
```

这个镜像是腾讯cnb构建好的，他们有个仓库，仓库里面有构建镜像所需的文件，我只是把Dockerfile给你看下会不会有大问题。

然后，我大概需要python的openai包，还需要有vscode，这个cnb镜像中应该已经有了，对于左右分终端，不知道需要什么依赖，还有什么？我暂时想到这些，因为这个AI编程工具比较简单，不是很多依赖似乎。

然后，cmd-ai-dev.py我打算放代码实现，我估计一个py文件就够了，除非有很大的东西，实现起来很长，不得不再分一个代码文件。

我还想到一点，模型在工作的时候，它有一个属于自己的工作目录，用于存放它为了完成任务而编写的，辅助它工作的python、shell脚本，或者什么资料。
这些东西不放用户的项目代码库中，很多编程工具会将这些东西放代码库中，我觉得不好，有时不希望将这些东西提交到git还得添加到排除文件，侵入性太高。
AI编程工具还得为它添加排除文件，太污染项目。

所以，它有一个单独的工作目录来存放这些东西。我打算设置在/workspace-ai，而用户的项目代码库在/workspace，当然这些都是在容器里面的路径。
/workspace-ai默认不映射到容器外，用户想映射就在docker-compose.yaml自己添加个映射，估计可行。
/workspace自然是映射到容器外。

上下文也以json的形式记录到/workspace-ai，直接一个json文件就行，不需要多个会话，因为我打算一个容器对应一个用户的项目对应一个会话，用户想开新会话就删掉json文件（或者通过AI编程工具来删除），AI编程工具启动就读现有的会话就可以。

为什么只有1个会话呢？因为实际使用中，根本不需要多个会话，代码是随时在变的，用户回到老会话继续开发是不现实的，比较现实的是模型在/workspace-ai自己记录变更和重要内容、注意事项等。

对于将命令行提供给模型，我打算让模型提供两个东西，1个是要执行的命令（可以是单行命令，也可以是多行命令，或者由多个命令组成的片段，总之就能执行的字符串，没格式限制），另一个是超时时间，这个非必填，不填的时候默认一个，有的命令执行的时间比较长，有的命令执行时间比较短，由模型指定超时时间比较好。
无论命令执行成功还是失败，结果给到模型，模型自己决定下一步是如何重试还是什么。

模型工作的链条是由模型执行命令来驱动的，比如，模型执行命令，命令结果给到模型，模型再执行命令，命令结果给到模型，如此往复，如果模型不执行命令，链条就会停止。

在模型工作的链条进行的过程中，用户可以停止，当用户触发停止时，如果有没执行但准备执行的命令，则不执行，如果有正在执行的命令则中断命令执行，如果有没发送给模型的结果则不发送，如果模型在输出文字则允许模型输出完成，但命令不会执行。停止之后记得在上下文中拼接提示，提示指明了停止的情况，防止模型困惑。

用户可以在模型工作的链条进行的过程中与模型交互，不过交互有延迟，命令执行的结果被发送给模型时，顺带把用户交互的内容给模型。

虽然json形式的函数调用很好，但我不打算使用它，因为huggingface的smolagents项目也没使用json形式的函数调用。

不使用json形式的函数调用，就可以不用openai库提供的函数调用方式了。

我打算定义格式，从模型的回答中拿到需要执行的命令行，再将命令执行的结果用格式包装后给到模型。

我是这样想的，模型返回这样的格式（当然外围不带代码块，代码块是为了在这里呈现给你时分隔加的）：
```
<cmd>
<time_out>60</time_out>
这里是要执行的命令
</cmd>
这里是模型的回答
```
超时时间单位是秒。

AI编程工具给模型这样的格式：
```
<cmdout>
这里是命令输出
</cmdout>
这里是用户的交互
```

因情况而异，要执行的命令、模型的回答、命令的输出、用户的交互不一定都存在。

比如，对于模型返回的内容：
如果不执行命令，那就只有模型的回答，没有要执行命令的xml标签。
如果模型提供了要执行的命令，但没提供回答，那么就只有要执行的命令，没有回答。

对于发送给模型的内容：
如果没执行命令，那发送给模型的内容，就只有用户交互了。
如果执行的是一个没有结果返回的命令，并且没有用户交互，则只有命令输出的xml标签，但标签里没有内容。
如果没有用户交互，但执行了命令，则只有命令的输出（输出空则只有xml标签，否则是命令执行结果）。

如果都有，就都有呗。


我们用openai包，但是你需要封装好，以便我在需要时修改代码，不用openai包，自己发请求。
所以需要封装好，以便容易的切换。

差不多就是这样，你打算怎么做？